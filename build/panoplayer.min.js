!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.initPanoPlayer=t():e.initPanoPlayer=t()}(window,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BomUtil={getBrowser:function(){var e=navigator.userAgent.toLowerCase(),t=(e.match(/firefox|chrome|safari|opera/g)||"other")[0];(e.match(/edge|msie|trident/g)||[])[0]&&(t="msie");var i,n="",r="",a="",o="";switch(n="ontouchstart"in window||-1!==e.indexOf("touch")||-1!==e.indexOf("mobile")?-1!==e.indexOf("ipad")?"pad":-1!==e.indexOf("mobile")?"mobile":-1!==e.indexOf("android")?"androidPad":"other":"pc",t){case"chrome":case"safari":case"mobile":r="webkit";break;case"msie":r="ms";break;case"firefox":r="Moz";break;case"opera":r="O";break;default:r="webkit"}if("android"===(i=e.indexOf("android")>0?"android":navigator.platform.toLowerCase())){e.indexOf("huawei")>0?a="Huawei":e.indexOf("xiaomi")>0?a="XiaoMi":e.indexOf("vivo")>0?a="Vivo":e.indexOf("oppo")>0?a="Oppo":e.indexOf("pixel")>0&&(a="Pixel");var s=e.match(/Android (\d+(?:\.\d+)*);/i);o=s&&s.length>=2?s[1]:""}else/iPhone|iPod|iPad/i.test(e)&&(a="Apple");return{version:(e.match(/[\s\S]+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],platform:i,type:t,pc:n,prefix:r,isMobile:"pc"!==n&&"other"!==n,brand:a,aOSVer:o,ua:e}},loadResource:function(e,t){var i=this.createXMLHttp(),n=e;i.open("GET",n,!0),i.send(),i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText||i.response;t&&"function"==typeof t&&t(e)}}},createXMLHttp:function(){if(window.ActiveXObject)for(var e=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],t=0;t<e.length;t++)try{return new window.ActiveXObject(e[t])}catch(e){}else try{return new XMLHttpRequest}catch(e){}},support_WebGL:function(){if(window.WebGLRenderingContext){var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"];for(var i in t)try{if(!!e.getContext(t[i]))return!0}catch(e){return!1}return!1}return!1},isSupportFullScreen:function(){var e=document.documentElement,t=navigator.userAgent.toLowerCase();return!/mqqbrowser\//i.test(t)&&("requestFullscreen"in e||"webkitRequestFullScreen"in e||"mozRequestFullScreen"in e&&document.mozFullScreenEnabled||!1)},isFullScreen:function(){return document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.webkitIsFullScreen||!1},reqFullScreen:function(e){var t=document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.webkitIsFullScreen,i=e||document.documentElement;return t?(document.exitFullscreen&&document.exitFullscreen(),document.cancelFullScreen&&document.cancelFullScreen(),document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),document.msExitFullscreen&&document.msExitFullscreen(),document.mozCancelFullScreen&&document.mozCancelFullScreen(),document.oCancelFullScreen&&document.oCancelFullScreen(),!1):(i.requestFullScreen&&i.requestFullScreen(),i.webkitRequestFullScreen&&i.webkitRequestFullScreen(),i.msRequestFullscreen&&i.msRequestFullscreen(),i.mozRequestFullScreen&&i.mozRequestFullScreen(),i.oRequestFullScreen&&i.oRequestFullScreen(),!0)},getFileExt:function(e){var t=/(\.[a-zA-Z0-9]+)(?:\?|$)/.exec(e);return t?t[1]:null},isMobile:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,/android|iPhone|iPad|iPod/i.test(e)&&(t=!0),t},isEmptyObject:function(e){var t=void 0;for(t in e)return!1;return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2);e.exports=function(e){if(console.debug(e),!e)return null;var t=e.sceneOpt;delete e.sceneOpt;var i={domData:{container:e.container||document.body,name:e.name||"Panorama",externalPlayerDom:e.useExternalPlayer?e.externalPlayerDom:void 0},ctrlData:{gyroCtrl:{isGyro:e.isGyro},dragCtrl:{isDragAble:e.isDragAble,dragStartMode:e.dragStartMode,dragDirectionMode:e.dragDirectionMode},fullscreenCtrl:{fullScreenDom:e.fullScreenDom},isAutoRotate:e.isAutoRotate,isMouseWheel:e.isMouseWheel,isDBClick:e.isDBClick,isDisplayMsg:e.isDisplayMsg,preventDefaultErrorHandle:e.preventDefaultErrorHandle,useExternalPlayer:e.useExternalPlayer},sceneOpt:t,handlers:e.handlers};return new n.default(i)}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r,a,o,s,u,l,c,h,d,v,f,g,m,p,y,M,_,b=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},w=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});var D=i(3),x=i(0),E=i(4),T=i(5),P=i(6),S=i(7),k=i(8),F=i(10),A=i(11),C=i(12),U=i(13),L=i(14),R=i(15),I=P.default.mat4,B=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version="2.0.0.6",r.set(this,void 0),a.set(this,void 0),o.set(this,void 0),s.set(this,void 0),u.set(this,void 0),l.set(this,!1),c.set(this,!1),h.set(this,void 0),d.set(this,void 0),v.set(this,void 0),f.set(this,void 0),g.set(this,void 0),m.set(this,void 0),p.set(this,void 0),y.set(this,void 0),M.set(this,void 0),_.set(this,void 0),console.log("PanoPlayer v"+this.version),console.debug(t),b(this,r,x.BomUtil.getBrowser()),b(this,u,{}),b(this,g,{}),b(this,m,{}),b(this,m,{sphere:{},dual:{},planet:{}}),b(this,M,{}),b(this,_,{}),this._initDomData(t.domData),this._initCtrlData(t.ctrlData),this._initState(),this._setEventHandlers(t.handlers),this._createDom(),this._createDebugDom(),this._initSceneData(t.sceneOpt),w(this,u).isBlackWebGL=L.checkBrowser(w(this,r)),w(this,u).isBlackWebGL)return this.api_playerError(3),void console.debug(w(this,r).ua);this._isCanPlay()?(this._displayDebugMsg(),this._prepare2Render(),this._initActionEvent(w(this,a).scenePlayDom),this.api_startLoad()):(this._displayDebugMsg(),this.api_playerError(0))}return n(e,[{key:"_initDomData",value:function(e){b(this,a,{container:void 0,target:void 0,scenePlayDom:void 0,cubeDom:void 0,name:void 0,width:void 0,height:void 0,zIndex:void 0,debugWrapperDom:void 0,debugTextDom:void 0,debugPanelDom:void 0,debugPanelDataDom:void 0,messageDom:void 0,messageTextDom:void 0}),w(this,a).container=O(e,"container",document.body),w(this,a).name=O(e,"name","PanoPlayer"),w(this,a).width=O(e,"width",800),w(this,a).height=O(e,"height",600),w(this,a).zIndex=O(e,"zIndex",0),b(this,h,O(e,"externalPlayerDom",void 0))}},{key:"_initSceneData",value:function(e){b(this,o,{sceneMediaType:void 0,sceneResType:void 0,sceneVisionMode:void 0,sceneSpeed:void 0,sceneMediaPath:void 0,isVideoAutoPlay:void 0,isVideoLoop:void 0,initPan:void 0,initTilt:void 0,initFov:void 0,minTilt:void 0,maxTilt:void 0,minFov:void 0,maxFov:void 0,curPan:void 0,curTilt:void 0,curFov:void 0,fovType:void 0,preserveDrawingBuffer:void 0,projectionMatrix:void 0,curMVMatrix:void 0,viewHeight:void 0,viewWidth:void 0}),this._setSceneData(e),this._initDrawData(),this._setSceneResType()}},{key:"_getPlayerName",value:function(){return w(this,a).name}},{key:"_initCtrlData",value:function(e){var t=this;b(this,s,{gyroCtrl:{isGyro:void 0,supportsGyro:void 0,gyroErrMsg:void 0},dragCtrl:{isDragAble:void 0,dragStartMode:void 0,dragDirectionMode:void 0},mouseCtrl:{},fullscreenCtrl:{},isAutoRotate:void 0,isMouseWheel:void 0,isDBClick:void 0,isShowAboutInfo:void 0,isDisplayMsg:void 0,preventDefaultErrorHandle:void 0}),b(this,c,O(e,"useExternalPlayer",!1)),w(this,s).isAutoRotate=!!O(e,"isAutoRotate",!1),w(this,s).isMouseWheel=O(e,"isMouseWheel",!0),w(this,s).isDBClick=O(e,"isDBClick",!0),w(this,s).gyroCtrl={isGyro:O(e.gyroCtrl,"isGyro",null),supportsGyro:null,gyroErrMsg:""},w(this,s).dragCtrl={isDragAble:O(e.dragCtrl,"isDragAble",!0),dragStartMode:O(e.dragCtrl,"dragStartMode",D.DragStartMode.Mdown),dragDirectionMode:O(e.dragCtrl,"dragDirectionMode",!0)},w(this,s).isShowAboutInfo=!0,w(this,s).fullscreenCtrl.fullScreenDom=O(e.fullscreenCtrl,"fullScreenDom",w(this,a).container),w(this,s).isDisplayMsg=O(e,"isDisplayMsg",!0),w(this,s).preventDefaultErrorHandle=O(e,"preventDefaultErrorHandle",!1),w(this,r).isMobile?S.supports().then((function(){w(t,s).gyroCtrl.supportsGyro=!0,w(t,s).gyroCtrl.isGyro?t.api_openGyro():t.api_closeGyro()}),(function(e){console.warn(e),w(t,s).gyroCtrl.supportsGyro=!1,w(t,s).gyroCtrl.gyroErrMsg=e.msg,t.api_closeGyro()})):(w(this,s).gyroCtrl.supportsGyro=!1,w(this,s).gyroCtrl.gyroErrMsg="Only the mobile browser supports deviceorientation.",this.api_closeGyro())}},{key:"_initState",value:function(){w(this,u).isInited=!1,w(this,u).isLive=!1,w(this,u).isRunningFovUpdate=!1,w(this,u).isSceneLoaded=!1,w(this,u).isIdle=!1,w(this,u).lastActionTime=Date.now(),w(this,u).fovDistance=0,w(this,u).offsetFov=0,w(this,u).touchesDistance=0,w(this,u).isDragging=!1,w(this,u).startX=0,w(this,u).startY=0,w(this,u).endX=0,w(this,u).endY=0,w(this,u).triggerKeyCode=0,w(this,u).browserNativePlayerInfo={result:D.BrowserNativePlayerInfoResult.Pending,state:0,times:0},w(this,u).artificialTimeUpdate={timestamp:void 0,active:!0,lastTime:0}}},{key:"_setEventHandlers",value:function(e){A.bindThis(this),Object.keys(e).forEach((function(t){A.bindEvent(t,e[t])}))}},{key:"_setSceneData",value:function(e){w(this,o).sceneMediaType=O(e,"sceneMediaType",D.SceneMediaType.Video),w(this,o).sceneVisionMode=O(e,"sceneVisionMode",D.SceneVisionMode.Sphere),w(this,o).sceneSpeed=O(e,"sceneSpeed",8),w(this,o).sceneMediaPath=O(e,"sceneMediaPath",""),w(this,o).isVideoAutoPlay=O(e,"isVideoAutoPlay",!1),w(this,o).isVideoLoop=O(e,"isVideoLoop",!0),w(this,o).initPan=O(e,"initPan",180),w(this,o).minTilt=O(e,"minTilt",-90),w(this,o).initTilt=O(e,"initTilt",0),w(this,o).maxTilt=O(e,"maxTilt",90),w(this,o).initFov=O(e,"initFov",90),w(this,o).minFov=O(e,"minFov",10),w(this,o).maxFov=O(e,"maxFov",100),w(this,o).fovType=O(e,"fovType","Auto"),w(this,o).curFov=O(e,"curFov",0),w(this,o).curTilt=O(e,"curTilt",0),w(this,o).curPan=O(e,"curPan",0),w(this,o).preserveDrawingBuffer=O(e,"webGLDeepBuffer",!1)}},{key:"_initDrawData",value:function(){w(this,o).projectionMatrix=I.create(),w(this,o).curMVMatrix=I.create(),w(this,o).viewHeight=0,w(this,o).viewWidth=0}},{key:"_resetDom",value:function(){var e,t,i;null===(e=w(this,a).cubeDom)||void 0===e||e.remove(),w(this,a).cubeDom=null,null===(t=w(this,a).scenePlayDom)||void 0===t||t.remove(),w(this,a).scenePlayDom=null,null===(i=w(this,a).target)||void 0===i||i.remove(),w(this,a).target=null}},{key:"_createDom",value:function(){var e=this;this._resetDom(),w(this,a).target=E.DomUtil.cDom("div"),E.DomUtil.setProperties(w(this,a).target,{name:w(this,a).name}),E.DomUtil.setStyles(w(this,a).target,{position:"absolute",overflow:"hidden",width:"100%",height:"100%",backgroundColor:"black",left:"0px",top:"0px",zIndex:w(this,a).zIndex}),E.DomUtil.inject(w(this,a).target,w(this,a).container),w(this,a).scenePlayDom=E.DomUtil.cDom("div"),E.DomUtil.setProperties(w(this,a).scenePlayDom,{id:"scenePlayDom",tabIndex:-1}),E.DomUtil.setStyles(w(this,a).scenePlayDom,{position:"absolute",overflow:"hidden",height:"100%",width:"100%",cursor:"-webkit-grab",outline:"none"}),E.DomUtil.inject(w(this,a).scenePlayDom,w(this,a).target),w(this,a).scenePlayDom.style[w(this,r).prefix+"UserSelect"]="none",w(this,a).scenePlayDom.style[w(this,r).prefix+"TouchAction"]="none",w(this,a).scenePlayDom.style[w(this,r).prefix+"ContentZooming"]="none",w(this,a).cubeDom=E.DomUtil.cDom("div"),E.DomUtil.setProperties(w(this,a).cubeDom,{id:"cubeDom"}),E.DomUtil.setStyles(w(this,a).cubeDom,{position:"absolute",width:"100%",height:"100%",pointerEvents:"none"}),E.DomUtil.inject(w(this,a).cubeDom,w(this,a).scenePlayDom);var t=void 0,i=E.DomUtil.getSize(w(this,a).target);this._setSize(i.width,i.height),(t=new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)((function(){E.DomUtil.gId("scenePlayDom",w(e,a).container)||(e.api_videoPause(),w(e,u).isSceneLoaded=!1,b(e,h,null),t.disconnect())}))).observe(w(this,a).container,{childList:!0,subtree:!0})}},{key:"_setSceneResType",value:function(){(w(this,o).sceneResType=D.SceneResType.Video,/AppleWebKit\/(\d+\.\d)/i.test(w(this,r).ua))&&(+RegExp.$1>=602&&(w(this,o).sceneResType=D.SceneResType.Video));w(this,r).ua.toLowerCase().match(/edge|msie|trident/)&&(w(this,o).sceneResType=D.SceneResType.Canvas)}},{key:"_isCanPlay",value:function(){return x.BomUtil.support_WebGL()&&(w(this,c)||!!w(this,o).sceneMediaPath)}},{key:"_checkDebugMode",value:function(){b(this,l,window.location.search.indexOf("debug=true")>0)}},{key:"_createDebugDom",value:function(){this._checkDebugMode(),w(this,l)&&(w(this,a).debugWrapperDom=E.DomUtil.cDom("div"),E.DomUtil.setStyles(w(this,a).debugWrapperDom,{position:"absolute",left:"0%",top:"80%",color:"rgb(255, 255, 255)",fontSize:"14px",zIndex:9999,pointerEvents:"none"}),E.DomUtil.inject(w(this,a).debugWrapperDom,w(this,a).target),w(this,a).debugTextDom=E.DomUtil.cDom("p"),E.DomUtil.inject(w(this,a).debugTextDom,w(this,a).debugWrapperDom),E.DomUtil.setStyles(w(this,a).debugTextDom,{display:"block",textAlign:"center",textShadow:"rgb(0, 0, 0) 1px 1px 2px",marginTop:"-25px"}))}},{key:"_displayDebugMsg",value:function(){if(w(this,l)){var e="???"+w(this,o).sceneMediaType+"__"+w(this,a).width+"px__"+w(this,a).height+"px__"+w(this,r).ua;w(this,a).debugTextDom&&(w(this,a).debugTextDom.innerText=e),this._displayDebugDataPanel()}}},{key:"_displayDebugDataPanel",value:function(){var e=this;w(this,l)&&(w(this,_).fps=0,w(this,a).debugPanelDom||(w(this,a).debugPanelDom=E.DomUtil.cDom("div"),E.DomUtil.setStyles(w(this,a).debugPanelDom,{position:"absolute",right:"0%",top:"5%",color:"rgb(255, 255, 255)",fontSize:"14px",padding:"5px 8px",backgroundColor:"rgba(0, 180, 0, 0.8)",zIndex:9999,pointerEvents:"none"}),E.DomUtil.inject(w(this,a).debugPanelDom,w(this,a).target),w(this,a).debugPanelDataDom=E.DomUtil.cDom("p"),E.DomUtil.inject(w(this,a).debugPanelDataDom,w(this,a).debugPanelDom),E.DomUtil.setStyles(w(this,a).debugPanelDataDom,{display:"block",textShadow:"rgb(0, 0, 0) 1px 1px 2px"})),w(this,_).timeStamp&&window.clearInterval(w(this,_).timeStamp),w(this,_).timeStamp=window.setInterval((function(){w(e,a).debugPanelDataDom.innerText="fps: "+w(e,_).fps,w(e,_).fps=0}),1e3))}},{key:"_showMessage",value:function(e){w(this,s).isDisplayMsg?(this._removeMessageDom(),w(this,a).messageDom=E.DomUtil.cDom("div"),E.DomUtil.setStyles(w(this,a).messageDom,{position:"absolute",top:"30%",color:"rgb(255, 255, 255)",fontSize:"24px",zIndex:9999,opacity:.7,width:"100%",pointerEvents:"none"}),E.DomUtil.inject(w(this,a).messageDom,w(this,a).target),w(this,a).messageTextDom=E.DomUtil.cDom("p"),E.DomUtil.setStyles(w(this,a).messageTextDom,{display:"block",textAlign:"center",textShadow:"rgb(0, 0, 0) 1px 1px 2px"}),E.DomUtil.inject(w(this,a).messageTextDom,w(this,a).messageDom),w(this,a).messageTextDom.innerHTML=e):console.log("showMessage: "+e)}},{key:"_removeMessageDom",value:function(){w(this,a).messageDom&&E.DomUtil.destroy(w(this,a).messageDom)}},{key:"_createCanvasDom",value:function(){b(this,d,E.DomUtil.cDom("canvas")),w(this,d).setAttribute("crossorigin","anonymous"),E.DomUtil.setStyles(w(this,d),{position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}),E.DomUtil.inject(w(this,d),w(this,a).cubeDom)}},{key:"_getWebGLContext",value:function(){var e=null,t={alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:w(this,o).preserveDrawingBuffer};(e=w(this,d).getContext("webgl",t)).frontFace(e.CCW),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),b(this,v,e)}},{key:"_calcSceneSize",value:function(){var e=window.devicePixelRatio||1;w(this,o).viewWidth=w(this,a).width*e,w(this,o).viewHeight=w(this,a).height*e,w(this,v)&&(w(this,v).clearColor(0,0,0,1),w(this,d).width=w(this,o).viewWidth,w(this,d).height=w(this,o).viewHeight)}},{key:"_createShader",value:function(e,t){var i=w(this,v).createShader(e);return w(this,v).shaderSource(i,t),w(this,v).compileShader(i),i}},{key:"_createProgram",value:function(e,t){var i=w(this,v).createProgram(),n=this._createShader(w(this,v).VERTEX_SHADER,e),r=this._createShader(w(this,v).FRAGMENT_SHADER,t);return w(this,v).attachShader(i,n),w(this,v).attachShader(i,r),w(this,v).linkProgram(i),w(this,v).getProgramParameter(i,w(this,v).LINK_STATUS)||console.log("Shader Error!"),i}},{key:"_generatePrograms",value:function(){b(this,f,this._createProgram(w(this,m).sphere.vertexShader,w(this,m).sphere.fragmentShader))}},{key:"_startLoad",value:function(){R.clearGLBuffer(w(this,v),w(this,g)),this._createHiddenCanvas(),"Video"===w(this,o).sceneMediaType?this._loadVideo():"Image"===w(this,o).sceneMediaType&&this._loadImage()}},{key:"_prepare2Render",value:function(){this._initWebGLData(),this._createCanvasDom(),this._getWebGLContext(),this._generatePrograms(),R.runProgram(w(this,v),w(this,f)),this._calcSceneSize()}},{key:"_render",value:function(){w(this,u).triggerKeyCode&&this._cameraMoveHandler(),w(this,u).isRunningFovUpdate&&this._adjustFovByStep(),"Video"===w(this,o).sceneMediaType&&w(this,u).isPlaying?(this._bindTexImage(),w(this,u).isIdle=!1):Date.now()-w(this,u).lastActionTime>=500?w(this,u).isIdle=!0:w(this,u).isIdle=!1,w(this,g).vertexMatrixBuffer&&!w(this,u).isIdle&&(w(this,v).clear(w(this,v).COLOR_BUFFER_BIT|w(this,v).DEPTH_BUFFER_BIT),R.bindGLBuffer(w(this,v),w(this,g)),R.drawGraphics(w(this,v),w(this,g),this._getViewSize(),w(this,o).curMVMatrix,w(this,o).projectionMatrix),w(this,l)&&w(this,_).fps++,A.triggerEvent(D.PlayerEventName.drawWebGL))}},{key:"_bindTexImage",value:function(){var e=void 0,t=w(this,v);"Canvas"===w(this,o).sceneResType?(w(this,y).drawImage(w(this,h),0,0,w(this,p).width,w(this,p).height),e=w(this,p)):e=w(this,h);try{t.bindTexture(t.TEXTURE_2D,w(this,g).aTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null)}catch(e){this.api_playerError(2),console.debug(e)}}},{key:"_createSphereVertices",value:function(){for(var e=[],t=[],i=[],n=void 0,r=void 0,a=void 0,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,d=void 0,v=void 0,f=0;f<=48;f++){r=f*Math.PI/48,a=Math.sin(r),o=Math.cos(r);for(var g=0;g<=48;g++)n=2*g*Math.PI/48,s=Math.cos(n)*a,u=o,l=Math.sin(n)*a,v=g/48,d=f/48,t.push(v),t.push(d),e.push(1*s),e.push(1*u),e.push(1*l),48!==f&&48!==g&&(h=(c=49*f+g)+49,i.push(c),i.push(h),i.push(c+1),i.push(h),i.push(h+1),i.push(c+1))}return{ratioList:t,vertexMatrix:e,vertexIndexList:i}}},{key:"_initWebGLData",value:function(){b(this,d,null),b(this,v,null),w(this,m).sphere.vertexShader=C.default,w(this,m).sphere.fragmentShader=U.default,b(this,g,{aTexture:null,vertexIndexListBuffer:null,ratioListBuffer:null,vertexMatrixBuffer:null}),w(this,u).isPlaying=!1}},{key:"_initGLBuffer",value:function(e){console.debug(e);var t={};return t.aTexture=w(this,v).createTexture(),t.ratioListBuffer=w(this,v).createBuffer(),t.vertexMatrixBuffer=w(this,v).createBuffer(),t.vertexIndexListBuffer=w(this,v).createBuffer(),w(this,v).bindBuffer(w(this,v).ARRAY_BUFFER,t.ratioListBuffer),w(this,v).bufferData(w(this,v).ARRAY_BUFFER,new Float32Array(e.ratioList),w(this,v).STATIC_DRAW),t.ratioListBuffer.vertexSize=2,t.ratioListBuffer.sum=.5*e.ratioList.length,w(this,v).bindBuffer(w(this,v).ARRAY_BUFFER,t.vertexMatrixBuffer),w(this,v).bufferData(w(this,v).ARRAY_BUFFER,new Float32Array(e.vertexMatrix),w(this,v).STATIC_DRAW),t.vertexMatrixBuffer.vertexSize=3,t.vertexMatrixBuffer.sum=e.vertexMatrix.length/3,w(this,v).bindBuffer(w(this,v).ELEMENT_ARRAY_BUFFER,t.vertexIndexListBuffer),w(this,v).bufferData(w(this,v).ELEMENT_ARRAY_BUFFER,new Uint16Array(e.vertexIndexList),w(this,v).STATIC_DRAW),t.vertexIndexListBuffer.vertexSize=1,t.vertexIndexListBuffer.sum=e.vertexIndexList.length,t}},{key:"_getViewSize",value:function(){return{whRatio:w(this,o).viewWidth/w(this,o).viewHeight,viewWidth:w(this,o).viewWidth,viewHeight:w(this,o).viewHeight}}},{key:"_createHiddenCanvas",value:function(){b(this,p,E.DomUtil.cDom("canvas")),w(this,p).setAttribute("crossorigin","anonymous"),b(this,y,w(this,p).getContext("2d"))}},{key:"_createVideoDom",value:function(){w(this,r).isMobile&&(w(this,o).isVideoAutoPlay=!1);var e=E.DomUtil.cDom("video");return e.setAttribute("x5-video-player-fullscreen","false"),e.setAttribute("webkit-playsinline","true"),e.setAttribute("playsinline","true"),e.setAttribute("crossorigin","anonymous"),e.setAttribute("preload","auto"),e}},{key:"_fetchImage",value:function(e,t,i,n){var r=new Image;n||(r.crossOrigin="anonymous"),r.onload=function(){t&&t(r)},r.onerror=function(){i&&i(r)},r.src=e}},{key:"_initVideoDom",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this,r=arguments[3],a=arguments[4];return i>0&&(e.currentTime=i),Object.keys(r).forEach((function(t){w(n,M)[t]=T.EventUtil.addEvent(e,t,r[t],n)})),this._checkIsLive(e,t||w(this,o).sceneMediaPath),e.load(),a&&this.api_videoPlay(),this._removeMessageDom(),e}},{key:"_checkIsLive",value:function(e,t){if(0===w(this,o).sceneMediaPath.indexOf("rtmp://"))return w(this,u).isLive=!0,this.api_playerError(4),void console.debug(t);e.src=t}},{key:"_changeVideoPath",value:function(e,t){this._showMessage("切换中......"),this._initVideoDom(w(this,h),e,t,{},!0)}},{key:"_changeImagePath",value:function(e){var t=this;this._showMessage("切换中......"),this._fetchImage(e,(function(e){t._removeMessageDom(),w(t,v).bindTexture(w(t,v).TEXTURE_2D,w(t,g).aTexture),w(t,v).texImage2D(w(t,v).TEXTURE_2D,0,w(t,v).RGBA,w(t,v).RGBA,w(t,v).UNSIGNED_BYTE,e),w(t,v).bindTexture(w(t,v).TEXTURE_2D,null),A.triggerEvent(D.PlayerEventName.loaded)}),(function(){t._showMessage("出错啦......")}))}},{key:"_loadImage",value:function(){var e=this,t=this._createSphereVertices();b(this,g,this._initGLBuffer(t)),this._fetchImage(w(this,o).sceneMediaPath,(function(t){R.glBindTexture(w(e,v),w(e,g).aTexture,t),w(e,u).isSceneLoaded=!0,e._computeMatrices(),e._renderTimer(),e.api_autoPlay(),A.triggerEvent(D.PlayerEventName.loaded),e._removeMessageDom()}),(function(){this.showMessage("出错啦......")})),w(this,u).isInited||(w(this,u).isInited=!0,A.triggerEvent(D.PlayerEventName.inited))}},{key:"_loadVideo",value:function(e){if(!w(this,c)){b(this,h,this._createVideoDom());var t={loadstart:function(){this._showMessage("正在加载......"),A.triggerEvent(D.PlayerEventName.videoLoadStart)},loadedmetadata:function(){console.debug("loadedmetadata()");var e;this._removeMessageDom(),e=w(this,h),w(this,u).isSceneLoaded=!0,w(this,p).width=e.videoWidth||1920,w(this,p).height=e.videoHeight||960,this._initSphereScene(w(this,p)),A.triggerEvent(D.PlayerEventName.videoLoadMetaData),A.triggerEvent(D.PlayerEventName.loaded)},progress:function(){A.triggerEvent(D.PlayerEventName.videoLoadProgress)},timeupdate:function(){A.triggerEvent(D.PlayerEventName.videoUpdate),this._checkBlankScreen(),w(this,u).artificialTimeUpdate.active=!1},play:function(){A.triggerEvent(D.PlayerEventName.videoPlay)},pause:function(){A.triggerEvent(D.PlayerEventName.videoPause),w(this,u).artificialTimeUpdate.active&&window.clearInterval(w(this,u).artificialTimeUpdate.timestamp)},playing:function(){var e=this;console.debug("playing()");var t=/AppleWebKit\/(\d+\.\d)/i.test(w(this,r).ua)?+RegExp.$1:null;A.triggerEvent(D.PlayerEventName.videoPlaying),w(this,u).artificialTimeUpdate.active&&(window.clearInterval(w(this,u).artificialTimeUpdate.timestamp),w(this,u).artificialTimeUpdate.timestamp=window.setInterval((function(){if(w(e,h).paused)window.clearInterval(w(e,u).artificialTimeUpdate.timestamp);else{var t=w(e,h).currentTime;t>0&&t!==w(e,u).artificialTimeUpdate.lastTime&&(w(e,u).artificialTimeUpdate.lastTime=t,A.triggerEvent(D.PlayerEventName.videoUpdate,[!0]),e._checkBlankScreen())}}),1e3))},waiting:function(){A.triggerEvent(D.PlayerEventName.videoWaiting)},abort:function(){console.debug("abort"),w(this,u).artificialTimeUpdate.active&&window.clearInterval(w(this,u).artificialTimeUpdate.timestamp)},stalled:function(){console.debug("stalled")},error:function(){console.error("load Video Error");var e=w(this,h).error?w(this,h).error.code:"";A.triggerEvent(D.PlayerEventName.videoError,[e]),w(this,u).artificialTimeUpdate.active&&window.clearInterval(w(this,u).artificialTimeUpdate.timestamp)},ended:function(){w(this,o).isVideoLoop?this.api_videoPlay():(this.api_videoPause(),A.triggerEvent(D.PlayerEventName.videoPlayEnd)),w(this,u).artificialTimeUpdate.active&&window.clearInterval(w(this,u).artificialTimeUpdate.timestamp)},x5videoenterfullscreen:function(){this.api_videoPause()},x5videoexitfullscreen:function(){this.api_videoPause()}};this._initVideoDom(w(this,h),e,0,t,w(this,o).isVideoAutoPlay)}w(this,u).isInited||(w(this,u).isInited=!0,A.triggerEvent(D.PlayerEventName.inited)),this._computeMatrices(),console.debug(w(this,o).projectionMatrix),console.debug(w(this,o).curMVMatrix),this._renderTimer()}},{key:"_checkBlankScreen",value:function(){var e=this;w(this,u).isSceneLoaded&&"web"!==w(this,u).browserNativePlayerInfo.result&&(w(this,u).browserNativePlayerInfo.times>=3||w(this,h).videoWidth>1&&w(this,h).videoHeight>1&&(0===w(this,u).browserNativePlayerInfo.state?(console.debug("times: "+w(this,u).browserNativePlayerInfo.times),w(this,u).browserNativePlayerInfo.state++):1===w(this,u).browserNativePlayerInfo.state&&(console.debug("times: "+w(this,u).browserNativePlayerInfo.times),w(this,u).browserNativePlayerInfo.state++,setTimeout((function(){var t=k.check(w(e,h),w(e,h).videoWidth,w(e,h).videoHeight);w(e,u).browserNativePlayerInfo.state=3,t?(w(e,u).browserNativePlayerInfo.result=D.BrowserNativePlayerInfoResult.Native,w(e,u).browserNativePlayerInfo.times++,w(e,u).browserNativePlayerInfo.times>=3?(e.api_playerError(7),console.debug("currentTime: "+w(e,h).currentTime+"s, url: "+w(e,h).src)):w(e,u).browserNativePlayerInfo.state=0):w(e,u).browserNativePlayerInfo.result=D.BrowserNativePlayerInfoResult.Web}),2e3))))}},{key:"_initSphereScene",value:function(e){var t=this._createSphereVertices();b(this,g,this._initGLBuffer(t)),R.glBindTexture(w(this,v),w(this,g).aTexture,e)}},{key:"_renderTimer",value:function(){w(this,u).isSceneLoaded&&this._render(),requestAnimationFrame(this._renderTimer.bind(this))}},{key:"_calcFovDistance",value:function(){var e,t=void 0;return t="FovX"===w(this,o).fovType?w(this,a).width:"FovY"===w(this,o).fovType?w(this,a).height:w(this,a).width>w(this,a).height?w(this,a).width:w(this,a).height,e=2*Math.tan(2*Math.PI/360*(.5*w(this,o).curFov)),w(this,u).fovDistance=t/e,w(this,u).fovDistance}},{key:"_getFovY",value:function(){return"FovY"===w(this,o).fovType?w(this,o).curFov:"FovX"===w(this,o).fovType?180*Math.atan(.5*w(this,a).height/w(this,u).fovDistance)/Math.PI*2:w(this,a).width>w(this,a).height?180*Math.atan(.5*w(this,a).height/w(this,u).fovDistance)/Math.PI*2:w(this,o).curFov}},{key:"_setCurPan",value:function(e){isNaN(e)||(w(this,o).curPan=e),w(this,o).curPan%=360,w(this,o).curPan<0&&(w(this,o).curPan+=360)}},{key:"_setCurTilt",value:function(e){var t=void 0,i=void 0,n=void 0,r=void 0,s=w(this,o).maxTilt,u=w(this,o).minTilt;isNaN(e)&&(e=w(this,o).curTilt),90===s&&-90===u?(e>s-1&&(e=s-1),e<u+1&&(e=u+1),w(this,o).curTilt=e):(t=w(this,a).width/w(this,a).height,(i=360*Math.atan(Math.tan(w(this,o).curFov*Math.PI/360)/t)/Math.PI)>Math.abs(s-u)-2?(i=Math.abs(s-u)-2,w(this,o).curFov=360*Math.atan(Math.tan(i*Math.PI/360)*t)/Math.PI,w(this,o).curTilt=.5*(s+u)):s-u<180&&(n=s-.5*i,r=u+.5*i,90!==s&&e>n&&(e=n),-90!==u&&r>e&&(e=r),e>s-1&&(e=s-1),u+1>e&&(e=u+1),w(this,o).curTilt=e))}},{key:"_setCurFov",value:function(e){var t=w(this,o).minFov,i=w(this,o).maxFov;isNaN(e)||(w(this,o).curFov=e),w(this,o).curFov<t&&(w(this,o).curFov=t),w(this,o).curFov>i&&(w(this,o).curFov=i),this._calcFovDistance()}},{key:"_calcPanTiltFov",value:function(){this._setCurPan(),this._setCurTilt(),this._setCurFov()}},{key:"_setPanTiltFov",value:function(e,t,i){this._setCurPan(e),this._setCurTilt(t),this._setCurFov(i),this._calcPanTiltFov(),this._computeMatrices()}},{key:"_updatePanTiltAngle",value:function(e,t){this._setCurTilt(t),this._setCurPan(e),this._computeMatrices()}},{key:"_updateFovAngle",value:function(e,t){this._setCurFov(e),this._computeMatrices(void 0,t)}},{key:"_updatePanAngle",value:function(e){this._setCurPan(e),this._computeMatrices()}},{key:"_updateTiltAngle",value:function(e){this._setCurTilt(e),this._computeMatrices()}},{key:"_resizeHandler",value:function(){this._displayDebugMsg(),this._calcPanTiltFov(),this._calcSceneSize(),this._computeMatrices()}},{key:"_computeMatrices",value:function(e,t){var i=this._getFovY(),n=w(this,o).curPan,r=this._getViewSize().whRatio;if(w(this,o).projectionMatrix=I.create(),I.perspective(w(this,o).projectionMatrix,N(i),r,.001,1e3),!t){if(w(this,o).curMVMatrix=I.create(),e){var a=(s=e,l=[],Object.values(s).forEach((function(e,t){l.push(e),t%3==2&&l.push(0)})),l.concat([0,0,0,1]));I.multiply(w(this,o).curMVMatrix,w(this,o).curMVMatrix,a),I.rotateX(w(this,o).curMVMatrix,w(this,o).curMVMatrix,N(90)),I.rotateY(w(this,o).curMVMatrix,w(this,o).curMVMatrix,N(-90))}else I.rotateX(w(this,o).curMVMatrix,w(this,o).curMVMatrix,N(-w(this,o).curTilt)),I.rotateY(w(this,o).curMVMatrix,w(this,o).curMVMatrix,N(n+90));var s,l;w(this,u).lastActionTime=Date.now()}}},{key:"_initActionEvent",value:function(e){w(this,s).dragCtrl.dragStartMode===D.DragStartMode.Mover?T.EventUtil.addEvent(e,"mouseover",this._dragStartHandler4Mover,this):T.EventUtil.addEvent(e,"mousedown",this._dragStartHandler4Tap,this),T.EventUtil.addEvent(e,"touchstart",this._dragStartHandler4Tap,this),T.EventUtil.addEvent(document,"fullScreenChange",(function(){A.triggerEvent(D.PlayerEventName.fullScreenChange)}),this),"pc"===w(this,r).pc&&(T.EventUtil.addEvent(e,"keydown",this._spaceKeyHandler,this),T.EventUtil.addEvent(document,"keydown",this._directionKeyHandler,this),T.EventUtil.addEvent(document,"keyup",this._keyupHandler,this),T.EventUtil.addEvent(w(this,a).target,"contextmenu",(function(e){T.EventUtil.stopDefault(e),w(this,u).isDragging=!1,this.isShowAboutInfo&&this.showAboutInfo(e,this.getPlayerName())}),this),w(this,s).isMouseWheel&&T.EventUtil.addEvent(e,"mousewheel",this._mousewheelHandler,this),w(this,s).isDBClick&&T.EventUtil.addEvent(e,"dblclick",this.api_fullScreen,this),w(this,s).mouseCtrl.callMousemoveHandler=T.EventUtil.addEvent(e,"mousemove",this._mousemoveHandler,this))}},{key:"_keyupHandler",value:function(){this._resetFovStateData()}},{key:"_spaceKeyHandler",value:function(e){32===e.keyCode&&(T.EventUtil.stopDefault(e),this.api_videoTogglePlay())}},{key:"_directionKeyHandler",value:function(e){switch(e.keyCode){case 37:this.api_left();break;case 38:T.EventUtil.stopDefault(e),this.api_up();break;case 39:this.api_right();break;case 40:T.EventUtil.stopDefault(e),this.api_down()}}},{key:"_dragStartHandler4Mover",value:function(e){this._prepare2Drag(e),this._bindEvent4Dragging()}},{key:"_dragStartHandler4Tap",value:function(e){2!==T.EventUtil.getButton(e)&&(this._prepare2Drag(e),this._bindEvent4Dragging())}},{key:"_mousemoveHandler",value:function(e){A.triggerEvent(D.PlayerEventName.sceneEventMove,[e])}},{key:"_draggingHandler4Mover",value:function(e,t){if(w(this,s).dragCtrl.isDragAble&&w(this,u).isDragging){T.EventUtil.stopDefault(t);var i=T.EventUtil.getEventLoc(e);w(this,u).endX=i.x,w(this,u).endY=i.y,this._calcDragOffset()}}},{key:"_draggingHandler4Tap",value:function(e,t){var i=t.targetTouches.length,n=void 0,r=void 0;1===i?(this._draggingHandler4Mover(e,t),w(this,u).touchesDistance=0):2===i&&w(this,s).isMouseWheel&&(T.EventUtil.stopDefault(t),w(this,u).isDragging=!1,n=t.targetTouches,r=this._calcDistance({x:n[0].clientX,y:n[0].clientY},{x:n[1].clientX,y:n[1].clientY}),0===w(this,u).touchesDistance&&(w(this,u).touchesDistance=r),this._updateFovAngleByScale(w(this,u).touchesDistance/r),w(this,u).touchesDistance=r)}},{key:"_dragEndHandler4Tap",value:function(e){2!==T.EventUtil.getButton(e)&&(this._processTapEnd(e),this._unbindEvent4Dragging())}},{key:"_dragEndHandler4Mover",value:function(){w(this,u).isDragging=!1,this._unbindEvent4Dragging()}},{key:"_bindEvent4Dragging",value:function(){var e=w(this,a).scenePlayDom;w(this,s).dragCtrl.callDraggingHandler4Tap=T.EventUtil.addEvent(e,"touchmove",this._draggingHandler4Tap,this),w(this,s).dragCtrl.callDragEndHandler4Tap=T.EventUtil.addEvent(e,"touchend",this._dragEndHandler4Tap,this),w(this,s).dragCtrl.callDraggingHandler4Mover=T.EventUtil.addEvent(e,"mousemove",this._draggingHandler4Mover,this),w(this,s).dragCtrl.dragStartMode===D.DragStartMode.Mdown&&(w(this,s).dragCtrl.callDragEndHandler4Tap2=T.EventUtil.addEvent(e,"mouseup",this._dragEndHandler4Tap,this)),w(this,s).dragCtrl.callDragEndHandler4Mover=T.EventUtil.addEvent(e,"mouseout",this._dragEndHandler4Mover,this),T.EventUtil.removeEvent(e,"mousemove",w(this,s).mouseCtrl.callMousemoveHandler)}},{key:"_unbindEvent4Dragging",value:function(){var e=w(this,a).scenePlayDom;T.EventUtil.removeEvent(e,"touchmove",w(this,s).dragCtrl.callDraggingHandler4Tap),T.EventUtil.removeEvent(e,"touchend",w(this,s).dragCtrl.callDragEndHandler4Tap),T.EventUtil.removeEvent(e,"mousemove",w(this,s).dragCtrl.callDraggingHandler4Mover),T.EventUtil.removeEvent(e,"mouseup",w(this,s).dragCtrl.callDragEndHandler4Tap2),T.EventUtil.removeEvent(e,"mouseout",w(this,s).dragCtrl.callDragEndHandler4Mover),w(this,s).mouseCtrl.callMousemoveHandler=T.EventUtil.addEvent(e,"mousemove",this._mousemoveHandler,this)}},{key:"_mousewheelHandler",value:function(e){T.EventUtil.stopPropagation(e),T.EventUtil.stopDefault(e),w(this,u).offsetFov+=1.125*((e.wheelDelta||-e.detail)>0?1:-1),console.debug(w(this,u).offsetFov),w(this,u).isRunningFovUpdate=!0}},{key:"_updateFovAngleByScale",value:function(e){this._updateFovAngle(w(this,o).curFov*e,w(this,s).gyroCtrl.isGyro)}},{key:"_calcDistance",value:function(e,t){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}},{key:"_prepare2Drag",value:function(e){this._resetFovStateData();var t=T.EventUtil.getEventLoc(e);w(this,u).isDragging=!0,w(this,u).startX=w(this,u).endX=t.x,w(this,u).startY=w(this,u).endY=t.y,w(this,u).dragStartTime=(new Date).getTime(),A.triggerEvent(D.PlayerEventName.sceneEventDown,[e])}},{key:"_calcDragOffset",value:function(){var e=w(this,s).dragCtrl.dragDirectionMode?-1:1;this._updatePanTiltAngle(w(this,o).curPan+180*Math.atan((w(this,u).endX-w(this,u).startX)/w(this,u).fovDistance)/Math.PI*e,w(this,o).curTilt-180*Math.atan((w(this,u).endY-w(this,u).startY)/w(this,u).fovDistance)/Math.PI*e),w(this,u).startX=w(this,u).endX,w(this,u).startY=w(this,u).endY}},{key:"_processTapEnd",value:function(e){w(this,u).isDragging&&(A.triggerEvent(D.PlayerEventName.sceneEventUp,[e]),w(this,u).dragEndTime=(new Date).getTime(),w(this,u).dragEndTime-w(this,u).dragStartTime<150&&this._clickHandler(e),w(this,u).isDragging=!1,w(this,u).touchesDistance=0)}},{key:"_clickHandler",value:function(e){A.triggerEvent(D.PlayerEventName.sceneEventClick,[e])}},{key:"_setSize",value:function(e,t){w(this,a).width=Math.round(e),w(this,a).height=Math.round(t)}},{key:"_initPanTiltFov",value:function(e,t,i){w(this,o).curPan=1*(e||w(this,o).initPan),w(this,o).curTilt=1*(t||w(this,o).initTilt),w(this,o).curFov=1*(i||w(this,o).initFov)}},{key:"_cameraMoveHandler",value:function(e){var t=w(this,u).triggerKeyCode,i=void 0;if(0!==t)switch(e||(e=.05*w(this,o).sceneSpeed),t){case 37:i=w(this,o).curPan-e,this._updatePanAngle(i);break;case 39:i=w(this,o).curPan+e,this._updatePanAngle(i);break;case 38:i=w(this,o).curTilt+e,this._updateTiltAngle(i);break;case 40:i=w(this,o).curTilt-e,this._updateTiltAngle(i)}}},{key:"_adjustFovByStep",value:function(){w(this,u).offsetFov*=.875,w(this,o).curFov-=w(this,u).offsetFov,Math.abs(w(this,u).offsetFov)<.125?(w(this,u).offsetFov=0,w(this,u).isRunningFovUpdate=!1):this._updateFovAngle()}},{key:"_resetFovStateData",value:function(){w(this,u).isRunningFovUpdate=!1,w(this,u).triggerKeyCode=0}},{key:"_showAboutInfo",value:function(e,t){console.debug(t)}},{key:"_useVideoDom2Display",value:function(e){for(var t in b(this,h,w(this,h)||this._createVideoDom()),w(this,M))T.EventUtil.removeEvent(w(this,h),t,w(this,M)[t]);w(this,h).src=w(this,o).sceneMediaPath,0===e&&w(this,h).setAttribute("controls","true"),w(this,h).setAttribute("loop","true"),E.DomUtil.setStyles(w(this,h),{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",backgroundColor:"black"}),E.DomUtil.inject(w(this,h),0===e?w(this,a).scenePlayDom:w(this,a).cubeDom),w(this,h).play()}},{key:"api_screenShot",value:function(){return"android"===w(this,r).platform?"":w(this,d).toDataURL()}},{key:"api_autoPlay",value:function(){}},{key:"api_reset",value:function(){this._resetFovStateData(),w(this,o).curPan=Math.round(w(this,o).initPan),w(this,o).curTilt=Math.round(w(this,o).initTilt),w(this,o).curFov=Math.round(w(this,o).initFov),this._setPanTiltFov()}},{key:"api_left",value:function(){this._resetFovStateData(),w(this,u).triggerKeyCode=37}},{key:"api_right",value:function(){this._resetFovStateData(),w(this,u).triggerKeyCode=39}},{key:"api_up",value:function(){this._resetFovStateData(),w(this,u).triggerKeyCode=38}},{key:"api_down",value:function(){this._resetFovStateData(),w(this,u).triggerKeyCode=40}},{key:"api_zoomin",value:function(){}},{key:"api_zoomout",value:function(){}},{key:"api_toggleDragDirection",value:function(){return w(this,s).dragCtrl.dragDirectionMode=!w(this,s).dragCtrl.dragDirectionMode}},{key:"api_updatePanAngle",value:function(e){this._updatePanAngle(w(this,o).curPan+e)}},{key:"api_updateTiltAngle",value:function(e){this._updateTiltAngle(w(this,o).curTilt+e)}},{key:"api_updatePanTiltAngle",value:function(e,t){this._updatePanTiltAngle(w(this,o).curPan+e,w(this,o).curTilt+t)}},{key:"api_setPanTiltFov",value:function(e,t,i){this._setPanTiltFov(e,t,i)}},{key:"api_getSceneType",value:function(){return w(this,o).sceneMediaType}},{key:"api_updateScene",value:function(e){this._setSceneData(e),this.api_startLoad()}},{key:"api_startLoad",value:function(e,t,i){this._showMessage("正在加载......"),this._initPanTiltFov(e,t,i),this._calcPanTiltFov(),this._displayDebugMsg(),this._startLoad()}},{key:"api_resize",value:function(e,t){this._setSize(e,t),this._resizeHandler(),A.triggerEvent(D.PlayerEventName.sceneResize)}},{key:"api_closeGyro",value:function(){return w(this,r).isMobile?(w(this,s).gyroCtrl.isGyro=!1,this.api_setDragStatus(!0),S.close(),this._setPanTiltFov()):w(this,s).gyroCtrl.isGyro=!1,w(this,s).gyroCtrl.isGyro}},{key:"api_openGyro",value:function(){var e=this;return w(this,r).isMobile?(console.debug(S.isGranted()),S.isGranted()?(S.open((function(t){e.api_setMPMatrix(t.rotationMatrix),e._render()}),0),w(this,s).gyroCtrl.isGyro=!0,this.api_setDragStatus(!1)):S.supports().then((function(){w(e,s).gyroCtrl.supportsGyro=!0,e.api_openGyro()}),(function(t){console.warn(t),w(e,s).gyroCtrl.supportsGyro=!1,w(e,s).gyroCtrl.gyroErrMsg=t.msg,e.api_closeGyro()}))):w(this,s).gyroCtrl.isGyro=!1,w(this,s).gyroCtrl.isGyro}},{key:"api_toggleGyro",value:function(){return w(this,s).gyroCtrl.isGyro?this.api_closeGyro():this.api_openGyro()}},{key:"api_getGyroStatus",value:function(){return w(this,s).gyroCtrl.isGyro}},{key:"api_getDragStatus",value:function(){return w(this,s).dragCtrl.isDragAble}},{key:"api_setDragStatus",value:function(e){w(this,s).dragCtrl.isDragAble=!!e}},{key:"api_getVideoDom",value:function(){return w(this,h)}},{key:"api_videoLoad",value:function(){w(this,c)?console.debug("Cannot invoke this method while using external player."):w(this,h).load()}},{key:"api_videoPlay",value:function(){w(this,c)?console.debug("Cannot invoke this method while using external player."):w(this,h)&&(w(this,h).ended&&(w(this,h).currentTime=.1),w(this,h).play(),w(this,h).paused&&setTimeout(this.api_videoPlay,200),w(this,u).isPlaying=!0)}},{key:"api_videoPause",value:function(){w(this,c)?console.debug("Cannot invoke this method while using external player."):(w(this,h).pause(),w(this,u).isPlaying=!1)}},{key:"api_videoMute",value:function(e){if(!w(this,c))return void 0!==e&&(w(this,h).muted=e),w(this,h).muted;console.debug("Cannot invoke this method while using external player.")}},{key:"api_getVideoAutoPlay",value:function(){if(!w(this,c))return w(this,o).isVideoAutoPlay;console.debug("Cannot invoke this method while using external player.")}},{key:"api_getPlaying",value:function(){return w(this,u).isPlaying}},{key:"api_setPlaying",value:function(e){w(this,c)?(e&&!w(this,u).isSceneLoaded&&(this._removeMessageDom(),this._initSphereScene(w(this,p)),w(this,u).isSceneLoaded=!0,A.triggerEvent(D.PlayerEventName.loaded)),w(this,u).isPlaying=!!e):console.debug("Cannot invoke this method while NOT using external player.")}},{key:"api_videoTogglePlay",value:function(){w(this,c)?console.debug("Cannot invoke this method while using external player."):(w(this,u).isPlaying?this.api_videoPause():this.api_videoPlay(),A.triggerEvent(D.PlayerEventName.videoTogglePlay))}},{key:"api_videoCurTime",value:function(e){if(!w(this,c))return void 0!==e&&(w(this,h).currentTime=e,A.triggerEvent(D.PlayerEventName.videoUpdateCurTime)),w(this,h).currentTime;console.debug("Cannot invoke this method while using external player.")}},{key:"api_getCurPanTiltFov",value:function(){return{pan:w(this,o).curPan,tilt:w(this,o).curTilt,fov:w(this,o).curFov}}},{key:"api_getScenePlayDom",value:function(){return w(this,a).scenePlayDom}},{key:"api_getTargetDom",value:function(){return w(this,a).target}},{key:"api_getPlayerSize",value:function(){return{width:w(this,a).width,height:w(this,a).height,viewWidth:w(this,o).viewWidth,viewHeight:w(this,o).viewHeight}}},{key:"api_getFovDistance",value:function(){return this._calcFovDistance()}},{key:"api_setMPMatrix",value:function(e){this._computeMatrices(e)}},{key:"api_playerError",value:function(e){console.debug(e),w(this,u).isSceneLoaded=!1,4===e?this._showMessage("当前浏览器不支持直播..."):(w(this,s).preventDefaultErrorHandle||this._useVideoDom2Display(e),this._removeMessageDom()),A.triggerEvent(D.PlayerEventName.error,[e])}},{key:"api_getWebGLInfo",value:function(){return{webGL:w(this,v),viewWidth:w(this,o).viewWidth,viewHeight:w(this,o).viewHeight}}},{key:"api_updateVideoPath",value:function(e,t){w(this,c)?console.debug("Cannot invoke this method while using external player."):this._changeVideoPath(e,isNaN(t)?w(this,h).currentTime:t)}},{key:"api_updateImagePath",value:function(e){this._changeImagePath(e)}},{key:"api_fullScreen",value:function(){return!!x.BomUtil.isSupportFullScreen()&&x.BomUtil.reqFullScreen(w(this,s).fullscreenCtrl.fullScreenDom||w(this,a).target)}},{key:"api_getCurMVMatrix",value:function(){return w(this,o).curMVMatrix}}]),e}();function O(e,t,i){return void 0===e[t]?i:e[t]}function N(e){return e*Math.PI/180}r=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,v=new WeakMap,f=new WeakMap,g=new WeakMap,m=new WeakMap,p=new WeakMap,y=new WeakMap,M=new WeakMap,_=new WeakMap,F.default(),t.default=B},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.inited="inited",e.loaded="loaded",e.drawWebGL="drawWebGL",e.error="error",e.sceneResize="sceneResize",e.sceneEventMove="sceneEventMove",e.sceneEventUp="sceneEventUp",e.sceneEventDown="sceneEventDown",e.sceneEventClick="sceneEventClick",e.fullScreenChange="fullScreenChange",e.videoLoadProgress="videoLoadProgress",e.videoLoadStart="videoLoadStart",e.videoPlay="videoPlay",e.videoUpdate="videoUpdate",e.videoLoadMetaData="videoLoadMetaData",e.videoTogglePlay="videoTogglePlay",e.videoUpdateCurTime="videoUpdateCurTime",e.videoPlayEnd="videoPlayEnd",e.videoPlaying="videoPlaying",e.videoPause="videoPause",e.videoWaiting="videoWaiting",e.videoError="videoError"}(t.PlayerEventName||(t.PlayerEventName={})),function(e){e.Sphere="sphere",e.Dual="dual",e.Planet="planet"}(t.SceneVisionMode||(t.SceneVisionMode={})),function(e){e.Video="Video",e.Image="Image"}(t.SceneMediaType||(t.SceneMediaType={})),function(e){e.Video="Video",e.Canvas="Canvas"}(t.SceneResType||(t.SceneResType={})),function(e){e.Auto="Auto",e.FovX="FovX",e.FovY="FovY"}(t.FovType||(t.FovType={})),function(e){e.Mdown="mdown",e.Mover="mover"}(t.DragStartMode||(t.DragStartMode={})),function(e){e.Pending="pending",e.Native="native",e.Web="web"}(t.BrowserNativePlayerInfoResult||(t.BrowserNativePlayerInfoResult={})),function(e){e[e.PreTest=0]="PreTest",e[e.TestingEvent=1]="TestingEvent",e[e.TestingVision=2]="TestingVision",e[e.Tested=3]="Tested"}(t.BrowserNativePlayerInfoState||(t.BrowserNativePlayerInfoState={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DomUtil={query:function(e,t){return(t||document).querySelector(e)},gId:function(e,t){return"function"==typeof document.querySelector?this.query("#"+e,t):document.getElementById(e)?document.getElementById(e):null},cDom:function(e){return document.createElement(e)},inject:function(e,t){return t&&t.appendChild(e),e},setStyles:function(e,t){for(var i in t)e.style[i]=t[i];return e},setProperties:function(e,t){for(var i in t)e.setAttribute(i,t[i]);return e},destroy:function(e){e.parentNode&&e.parentNode.removeChild(e)},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ")}},getSize:function(e){var t=e.getBoundingClientRect(),i=t.top,n=t.bottom,r=t.left,a=t.right;return{top:i,left:r,right:a,bottom:n,width:t.width||a-r,height:t.height||n-i}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0);t.EventUtil={getEventName:function(e){var t=void 0;switch(n.BomUtil.getBrowser().prefix){case"webkit":t="webkitfullscreenchange";break;case"ms":t="MSFullscreenChange";break;case"O":t="ofullscreenchange";break;case"Moz":t="mozfullscreenchange";break;default:t="fullscreenchange"}return{mousewheel:/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",fullScreenChange:t,resize:"resize"}[e]||e},addEvent:function(e,i,n,r){var a=this.getEventName(i),o=function(i){var a=t.EventUtil.getEvent(i);n.call(r||e,a,i)};return e.addEventListener?e.addEventListener(a,o,!1):e.attachEvent?e.attachEvent("on"+a,o):e["on"+a]=o,o},removeEvent:function(e,t,i){var n=this.getEventName(t);return e.removeEventListener?e.removeEventListener(n,i,!1):e.detachEvent?e.detachEvent("on"+n,i):e["on"+n]=null,e},getEvent:function(e){return n.BomUtil.getBrowser().isMobile&&(t.EventUtil.stopDefault(e),t.EventUtil.stopPropagation(e)),e.changedTouches?e.changedTouches[0]:e||window.event},stopDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getButton:function(e){if(document.implementation.hasFeature("MouseEvents","2.0"))return e.button;switch(e.button){case 0:return 0;case 2:case 6:return 2;case 4:return 1}},getEventLoc:function(e){return{x:e.clientX,y:e.clientY}},getOffsetX:function(e){var t=e||window.event,i=t.target||t.srcElement;if(t.offsetX)return t.offsetX;var n=i.getBoundingClientRect();return t.clientX-n.left},getOffsetY:function(e){var t=e||window.event,i=t.target||t.srcElement;if(t.offsetY)return t.offsetY;var n=i.getBoundingClientRect();return t.clientY-n.top}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r,a,o,s,u,l,c,h,d,v,f,g,m,p={};n=p,r||(r=1e-6),a||(a="undefined"!=typeof Float32Array?Float32Array:Array),o||(o=Math.random),(s={}).setMatrixArrayType=function(e){a=e},void 0!==n&&(n.glMatrix=s),u=Math.PI/180,s.toRadian=function(e){return e*u},(l={}).create=function(){var e=new a(2);return e[0]=0,e[1]=0,e},l.clone=function(e){var t=new a(2);return t[0]=e[0],t[1]=e[1],t},l.fromValues=function(e,t){var i=new a(2);return i[0]=e,i[1]=t,i},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},l.set=function(e,t,i){return e[0]=t,e[1]=i,e},l.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},l.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},l.sub=l.subtract,l.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e},l.mul=l.multiply,l.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e},l.div=l.divide,l.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},l.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},l.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},l.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},l.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},l.dist=l.distance,l.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n},l.sqrDist=l.squaredDistance,l.length=function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},l.len=l.length,l.squaredLength=function(e){var t=e[0],i=e[1];return t*t+i*i},l.sqrLen=l.squaredLength,l.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},l.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},l.normalize=function(e,t){var i=t[0],n=t[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},l.cross=function(e,t,i){var n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e},l.lerp=function(e,t,i,n){var r=t[0],a=t[1];return e[0]=r+n*(i[0]-r),e[1]=a+n*(i[1]-a),e},l.random=function(e,t){t=t||1;var i=2*o()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},l.transformMat2=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e},l.transformMat2d=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r+i[4],e[1]=i[1]*n+i[3]*r+i[5],e},l.transformMat3=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e},l.transformMat4=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e},l.forEach=function(){var e=l.create();return function(t,i,n,r,a,o){var s,u;for(i||(i=2),n||(n=0),u=r?Math.min(r*i+n,t.length):t.length,s=n;u>s;s+=i)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}(),l.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},void 0!==n&&(n.vec2=l),(c={}).create=function(){var e=new a(3);return e[0]=0,e[1]=0,e[2]=0,e},c.clone=function(e){var t=new a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},c.fromValues=function(e,t,i){var n=new a(3);return n[0]=e,n[1]=t,n[2]=i,n},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},c.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},c.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},c.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},c.sub=c.subtract,c.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e},c.mul=c.multiply,c.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},c.div=c.divide,c.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},c.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},c.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},c.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e},c.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(i*i+n*n+r*r)},c.dist=c.distance,c.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r},c.sqrDist=c.squaredDistance,c.length=function(e){var t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)},c.len=c.length,c.squaredLength=function(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n},c.sqrLen=c.squaredLength,c.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},c.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},c.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},c.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},c.cross=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=i[0],s=i[1],u=i[2];return e[0]=r*u-a*s,e[1]=a*o-n*u,e[2]=n*s-r*o,e},c.lerp=function(e,t,i,n){var r=t[0],a=t[1],o=t[2];return e[0]=r+n*(i[0]-r),e[1]=a+n*(i[1]-a),e[2]=o+n*(i[2]-o),e},c.random=function(e,t){var i,n,r;return t=t||1,i=2*o()*Math.PI,n=2*o()-1,r=Math.sqrt(1-n*n)*t,e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e[2]=n*t,e},c.transformMat4=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=i[3]*n+i[7]*r+i[11]*a+i[15];return o=o||1,e[0]=(i[0]*n+i[4]*r+i[8]*a+i[12])/o,e[1]=(i[1]*n+i[5]*r+i[9]*a+i[13])/o,e[2]=(i[2]*n+i[6]*r+i[10]*a+i[14])/o,e},c.transformMat3=function(e,t,i){var n=t[0],r=t[1],a=t[2];return e[0]=n*i[0]+r*i[3]+a*i[6],e[1]=n*i[1]+r*i[4]+a*i[7],e[2]=n*i[2]+r*i[5]+a*i[8],e},c.transformQuat=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=i[0],s=i[1],u=i[2],l=i[3],c=l*n+s*a-u*r,h=l*r+u*n-o*a,d=l*a+o*r-s*n,v=-o*n-s*r-u*a;return e[0]=c*l+v*-o+h*-u-d*-s,e[1]=h*l+v*-s+d*-o-c*-u,e[2]=d*l+v*-u+c*-s-h*-o,e},c.rotateX=function(e,t,i,n){var r=[],a=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],a[0]=r[0],a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},c.rotateY=function(e,t,i,n){var r=[],a=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),a[1]=r[1],a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},c.rotateZ=function(e,t,i,n){var r=[],a=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),a[2]=r[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},c.forEach=function(){var e=c.create();return function(t,i,n,r,a,o){var s,u;for(i||(i=3),n||(n=0),u=r?Math.min(r*i+n,t.length):t.length,s=n;u>s;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),c.angle=function(e,t){var i,n=c.fromValues(e[0],e[1],e[2]),r=c.fromValues(t[0],t[1],t[2]);return c.normalize(n,n),c.normalize(r,r),(i=c.dot(n,r))>1?0:Math.acos(i)},c.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},void 0!==n&&(n.vec3=c),(h={}).create=function(){var e=new a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},h.clone=function(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.fromValues=function(e,t,i,n){var r=new a(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},h.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},h.set=function(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e},h.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},h.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e},h.sub=h.subtract,h.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e},h.mul=h.multiply,h.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e},h.div=h.divide,h.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},h.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},h.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},h.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},h.distance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(i*i+n*n+r*r+a*a)},h.dist=h.distance,h.squaredDistance=function(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],a=t[3]-e[3];return i*i+n*n+r*r+a*a},h.sqrDist=h.squaredDistance,h.length=function(e){var t=e[0],i=e[1],n=e[2],r=e[3];return Math.sqrt(t*t+i*i+n*n+r*r)},h.len=h.length,h.squaredLength=function(e){var t=e[0],i=e[1],n=e[2],r=e[3];return t*t+i*i+n*n+r*r},h.sqrLen=h.squaredLength,h.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},h.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},h.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=i*i+n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},h.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},h.lerp=function(e,t,i,n){var r=t[0],a=t[1],o=t[2],s=t[3];return e[0]=r+n*(i[0]-r),e[1]=a+n*(i[1]-a),e[2]=o+n*(i[2]-o),e[3]=s+n*(i[3]-s),e},h.random=function(e,t){return t=t||1,e[0]=o(),e[1]=o(),e[2]=o(),e[3]=o(),h.normalize(e,e),h.scale(e,e,t),e},h.transformMat4=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*o,e},h.transformQuat=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=i[0],s=i[1],u=i[2],l=i[3],c=l*n+s*a-u*r,h=l*r+u*n-o*a,d=l*a+o*r-s*n,v=-o*n-s*r-u*a;return e[0]=c*l+v*-o+h*-u-d*-s,e[1]=h*l+v*-s+d*-o-c*-u,e[2]=d*l+v*-u+c*-s-h*-o,e},h.forEach=function(){var e=h.create();return function(t,i,n,r,a,o){var s,u;for(i||(i=4),n||(n=0),u=r?Math.min(r*i+n,t.length):t.length,s=n;u>s;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),h.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},void 0!==n&&(n.vec4=h),(d={}).create=function(){var e=new a(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},d.clone=function(e){var t=new a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},d.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},d.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},d.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},d.invert=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=i*a-r*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-r*o,e[3]=i*o,e):null},d.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},d.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},d.multiply=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=i[0],u=i[1],l=i[2],c=i[3];return e[0]=n*s+a*u,e[1]=r*s+o*u,e[2]=n*l+a*c,e[3]=r*l+o*c,e},d.mul=d.multiply,d.rotate=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=n*u+a*s,e[1]=r*u+o*s,e[2]=n*-s+a*u,e[3]=r*-s+o*u,e},d.scale=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=i[0],u=i[1];return e[0]=n*s,e[1]=r*s,e[2]=a*u,e[3]=o*u,e},d.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},d.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},d.LDU=function(e,t,i,n){return e[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-e[2]*i[1],[e,t,i]},void 0!==n&&(n.mat2=d),(v={}).create=function(){var e=new a(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},v.clone=function(e){var t=new a(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},v.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},v.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},v.invert=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=i*a-n*r;return u?(u=1/u,e[0]=a*u,e[1]=-n*u,e[2]=-r*u,e[3]=i*u,e[4]=(r*s-a*o)*u,e[5]=(n*o-i*s)*u,e):null},v.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},v.multiply=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1],h=i[2],d=i[3],v=i[4],f=i[5];return e[0]=n*l+a*c,e[1]=r*l+o*c,e[2]=n*h+a*d,e[3]=r*h+o*d,e[4]=n*v+a*f+s,e[5]=r*v+o*f+u,e},v.mul=v.multiply,v.rotate=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=Math.sin(i),c=Math.cos(i);return e[0]=n*c+a*l,e[1]=r*c+o*l,e[2]=n*-l+a*c,e[3]=r*-l+o*c,e[4]=s,e[5]=u,e},v.scale=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1];return e[0]=n*l,e[1]=r*l,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=u,e},v.translate=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1];return e[0]=n,e[1]=r,e[2]=a,e[3]=o,e[4]=n*l+a*c+s,e[5]=r*l+o*c+u,e},v.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},v.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},void 0!==n&&(n.mat2d=v),(f={}).create=function(){var e=new a(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},f.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},f.clone=function(e){var t=new a(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},f.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},f.invert=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,d=-c*a+s*u,v=l*a-o*u,f=i*h+n*d+r*v;return f?(f=1/f,e[0]=h*f,e[1]=(-c*n+r*l)*f,e[2]=(s*n-r*o)*f,e[3]=d*f,e[4]=(c*i-r*u)*f,e[5]=(-s*i+r*a)*f,e[6]=v*f,e[7]=(-l*i+n*u)*f,e[8]=(o*i-n*a)*f,e):null},f.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=r*l-n*c,e[2]=n*s-r*o,e[3]=s*u-a*c,e[4]=i*c-r*u,e[5]=r*a-i*s,e[6]=a*l-o*u,e[7]=n*u-i*l,e[8]=i*o-n*a,e},f.determinant=function(e){var t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+i*(-l*r+o*s)+n*(u*r-a*s)},f.multiply=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=i[0],v=i[1],f=i[2],g=i[3],m=i[4],p=i[5],y=i[6],M=i[7],_=i[8];return e[0]=d*n+v*o+f*l,e[1]=d*r+v*s+f*c,e[2]=d*a+v*u+f*h,e[3]=g*n+m*o+p*l,e[4]=g*r+m*s+p*c,e[5]=g*a+m*u+p*h,e[6]=y*n+M*o+_*l,e[7]=y*r+M*s+_*c,e[8]=y*a+M*u+_*h,e},f.mul=f.multiply,f.translate=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=i[0],v=i[1];return e[0]=n,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=d*n+v*o+l,e[7]=d*r+v*s+c,e[8]=d*a+v*u+h,e},f.rotate=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=Math.sin(i),v=Math.cos(i);return e[0]=v*n+d*o,e[1]=v*r+d*s,e[2]=v*a+d*u,e[3]=v*o-d*n,e[4]=v*s-d*r,e[5]=v*u-d*a,e[6]=l,e[7]=c,e[8]=h,e},f.scale=function(e,t,i){var n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},f.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},f.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=i+i,s=n+n,u=r+r,l=i*o,c=n*o,h=n*s,d=r*o,v=r*s,f=r*u,g=a*o,m=a*s,p=a*u;return e[0]=1-h-f,e[3]=c-p,e[6]=d+m,e[1]=c+p,e[4]=1-l-f,e[7]=v-g,e[2]=d-m,e[5]=v+g,e[8]=1-l-h,e},f.normalFromMat4=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],v=t[11],f=t[12],g=t[13],m=t[14],p=t[15],y=i*s-n*o,M=i*u-r*o,_=i*l-a*o,b=n*u-r*s,w=n*l-a*s,D=r*l-a*u,x=c*g-h*f,E=c*m-d*f,T=c*p-v*f,P=h*m-d*g,S=h*p-v*g,k=d*p-v*m,F=y*k-M*S+_*P+b*T-w*E+D*x;return F?(F=1/F,e[0]=(s*k-u*S+l*P)*F,e[1]=(u*T-o*k-l*E)*F,e[2]=(o*S-s*T+l*x)*F,e[3]=(r*S-n*k-a*P)*F,e[4]=(i*k-r*T+a*E)*F,e[5]=(n*T-i*S-a*x)*F,e[6]=(g*D-m*w+p*b)*F,e[7]=(m*_-f*D-p*M)*F,e[8]=(f*w-g*_+p*y)*F,e):null},f.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},f.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},void 0!==n&&(n.mat3=f),(g={}).create=function(){var e=new a(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.clone=function(e){var t=new a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},g.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},g.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=a,e[11]=t[14],e[12]=r,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},g.invert=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],v=t[11],f=t[12],g=t[13],m=t[14],p=t[15],y=i*s-n*o,M=i*u-r*o,_=i*l-a*o,b=n*u-r*s,w=n*l-a*s,D=r*l-a*u,x=c*g-h*f,E=c*m-d*f,T=c*p-v*f,P=h*m-d*g,S=h*p-v*g,k=d*p-v*m,F=y*k-M*S+_*P+b*T-w*E+D*x;return F?(F=1/F,e[0]=(s*k-u*S+l*P)*F,e[1]=(r*S-n*k-a*P)*F,e[2]=(g*D-m*w+p*b)*F,e[3]=(d*w-h*D-v*b)*F,e[4]=(u*T-o*k-l*E)*F,e[5]=(i*k-r*T+a*E)*F,e[6]=(m*_-f*D-p*M)*F,e[7]=(c*D-d*_+v*M)*F,e[8]=(o*S-s*T+l*x)*F,e[9]=(n*T-i*S-a*x)*F,e[10]=(f*w-g*_+p*y)*F,e[11]=(h*_-c*w-v*y)*F,e[12]=(s*E-o*P-u*x)*F,e[13]=(i*P-n*E+r*x)*F,e[14]=(g*M-f*b-m*y)*F,e[15]=(c*b-h*M+d*y)*F,e):null},g.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],v=t[11],f=t[12],g=t[13],m=t[14],p=t[15];return e[0]=s*(d*p-v*m)-h*(u*p-l*m)+g*(u*v-l*d),e[1]=-(n*(d*p-v*m)-h*(r*p-a*m)+g*(r*v-a*d)),e[2]=n*(u*p-l*m)-s*(r*p-a*m)+g*(r*l-a*u),e[3]=-(n*(u*v-l*d)-s*(r*v-a*d)+h*(r*l-a*u)),e[4]=-(o*(d*p-v*m)-c*(u*p-l*m)+f*(u*v-l*d)),e[5]=i*(d*p-v*m)-c*(r*p-a*m)+f*(r*v-a*d),e[6]=-(i*(u*p-l*m)-o*(r*p-a*m)+f*(r*l-a*u)),e[7]=i*(u*v-l*d)-o*(r*v-a*d)+c*(r*l-a*u),e[8]=o*(h*p-v*g)-c*(s*p-l*g)+f*(s*v-l*h),e[9]=-(i*(h*p-v*g)-c*(n*p-a*g)+f*(n*v-a*h)),e[10]=i*(s*p-l*g)-o*(n*p-a*g)+f*(n*l-a*s),e[11]=-(i*(s*v-l*h)-o*(n*v-a*h)+c*(n*l-a*s)),e[12]=-(o*(h*m-d*g)-c*(s*m-u*g)+f*(s*d-u*h)),e[13]=i*(h*m-d*g)-c*(n*m-r*g)+f*(n*d-r*h),e[14]=-(i*(s*m-u*g)-o*(n*m-r*g)+f*(n*u-r*s)),e[15]=i*(s*d-u*h)-o*(n*d-r*h)+c*(n*u-r*s),e},g.determinant=function(e){var t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],v=e[12],f=e[13],g=e[14],m=e[15];return(t*o-i*a)*(h*m-d*g)-(t*s-n*a)*(c*m-d*f)+(t*u-r*a)*(c*g-h*f)+(i*s-n*o)*(l*m-d*v)-(i*u-r*o)*(l*g-h*v)+(n*u-r*s)*(l*f-c*v)},g.multiply=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],v=t[10],f=t[11],g=t[12],m=t[13],p=t[14],y=t[15],M=i[0],_=i[1],b=i[2],w=i[3];return e[0]=M*n+_*s+b*h+w*g,e[1]=M*r+_*u+b*d+w*m,e[2]=M*a+_*l+b*v+w*p,e[3]=M*o+_*c+b*f+w*y,M=i[4],_=i[5],b=i[6],w=i[7],e[4]=M*n+_*s+b*h+w*g,e[5]=M*r+_*u+b*d+w*m,e[6]=M*a+_*l+b*v+w*p,e[7]=M*o+_*c+b*f+w*y,M=i[8],_=i[9],b=i[10],w=i[11],e[8]=M*n+_*s+b*h+w*g,e[9]=M*r+_*u+b*d+w*m,e[10]=M*a+_*l+b*v+w*p,e[11]=M*o+_*c+b*f+w*y,M=i[12],_=i[13],b=i[14],w=i[15],e[12]=M*n+_*s+b*h+w*g,e[13]=M*r+_*u+b*d+w*m,e[14]=M*a+_*l+b*v+w*p,e[15]=M*o+_*c+b*f+w*y,e},g.mul=g.multiply,g.translate=function(e,t,i){var n,r,a,o,s,u,l,c,h,d,v,f,g=i[0],m=i[1],p=i[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*p+t[12],e[13]=t[1]*g+t[5]*m+t[9]*p+t[13],e[14]=t[2]*g+t[6]*m+t[10]*p+t[14],e[15]=t[3]*g+t[7]*m+t[11]*p+t[15]):(n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],v=t[10],f=t[11],e[0]=n,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=d,e[10]=v,e[11]=f,e[12]=n*g+s*m+h*p+t[12],e[13]=r*g+u*m+d*p+t[13],e[14]=a*g+l*m+v*p+t[14],e[15]=o*g+c*m+f*p+t[15]),e},g.scale=function(e,t,i){var n=i[0],r=i[1],a=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},g.rotate=function(e,t,i,n){var a,o,s,u,l,c,h,d,v,f,g,m,p,y,M,_,b,w,D,x,E,T,P,S,k=n[0],F=n[1],A=n[2],C=Math.sqrt(k*k+F*F+A*A);return Math.abs(C)<r?null:(k*=C=1/C,F*=C,A*=C,a=Math.sin(i),s=1-(o=Math.cos(i)),u=t[0],l=t[1],c=t[2],h=t[3],d=t[4],v=t[5],f=t[6],g=t[7],m=t[8],p=t[9],y=t[10],M=t[11],_=k*k*s+o,b=F*k*s+A*a,w=A*k*s-F*a,D=k*F*s-A*a,x=F*F*s+o,E=A*F*s+k*a,T=k*A*s+F*a,P=F*A*s-k*a,S=A*A*s+o,e[0]=u*_+d*b+m*w,e[1]=l*_+v*b+p*w,e[2]=c*_+f*b+y*w,e[3]=h*_+g*b+M*w,e[4]=u*D+d*x+m*E,e[5]=l*D+v*x+p*E,e[6]=c*D+f*x+y*E,e[7]=h*D+g*x+M*E,e[8]=u*T+d*P+m*S,e[9]=l*T+v*P+p*S,e[10]=c*T+f*P+y*S,e[11]=h*T+g*P+M*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},g.rotateX=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+l*n,e[5]=o*r+c*n,e[6]=s*r+h*n,e[7]=u*r+d*n,e[8]=l*r-a*n,e[9]=c*r-o*n,e[10]=h*r-s*n,e[11]=d*r-u*n,e},g.rotateY=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-l*n,e[1]=o*r-c*n,e[2]=s*r-h*n,e[3]=u*r-d*n,e[8]=a*n+l*r,e[9]=o*n+c*r,e[10]=s*n+h*r,e[11]=u*n+d*r,e},g.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+l*n,e[1]=o*r+c*n,e[2]=s*r+h*n,e[3]=u*r+d*n,e[4]=l*r-a*n,e[5]=c*r-o*n,e[6]=h*r-s*n,e[7]=d*r-u*n,e},g.fromRotationTranslation=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=n+n,u=r+r,l=a+a,c=n*s,h=n*u,d=n*l,v=r*u,f=r*l,g=a*l,m=o*s,p=o*u,y=o*l;return e[0]=1-(v+g),e[1]=h+y,e[2]=d-p,e[3]=0,e[4]=h-y,e[5]=1-(c+g),e[6]=f+m,e[7]=0,e[8]=d+p,e[9]=f-m,e[10]=1-(c+v),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},g.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=i+i,s=n+n,u=r+r,l=i*o,c=n*o,h=n*s,d=r*o,v=r*s,f=r*u,g=a*o,m=a*s,p=a*u;return e[0]=1-h-f,e[1]=c+p,e[2]=d-m,e[3]=0,e[4]=c-p,e[5]=1-l-f,e[6]=v+g,e[7]=0,e[8]=d+m,e[9]=v-g,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},g.frustum=function(e,t,i,n,r,a,o){var s=1/(i-t),u=1/(r-n),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(r+n)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*a*l,e[15]=0,e},g.perspective=function(e,t,i,n,r){var a=1/Math.tan(t/2),o=1/(n-r);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+n)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*n*o,e[15]=0,e},g.ortho=function(e,t,i,n,r,a,o){var s=1/(t-i),u=1/(n-r),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+i)*s,e[13]=(r+n)*u,e[14]=(o+a)*l,e[15]=1,e},g.lookAt=function(e,t,i,n){var a,o,s,u,l,c,h,d,v,f,m=t[0],p=t[1],y=t[2],M=n[0],_=n[1],b=n[2],w=i[0],D=i[1],x=i[2];return Math.abs(m-w)<r&&Math.abs(p-D)<r&&Math.abs(y-x)<r?g.identity(e):(h=m-w,d=p-D,v=y-x,a=_*(v*=f=1/Math.sqrt(h*h+d*d+v*v))-b*(d*=f),o=b*(h*=f)-M*v,s=M*d-_*h,(f=Math.sqrt(a*a+o*o+s*s))?(a*=f=1/f,o*=f,s*=f):(a=0,o=0,s=0),u=d*s-v*o,l=v*a-h*s,c=h*o-d*a,(f=Math.sqrt(u*u+l*l+c*c))?(u*=f=1/f,l*=f,c*=f):(u=0,l=0,c=0),e[0]=a,e[1]=u,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=d,e[7]=0,e[8]=s,e[9]=c,e[10]=v,e[11]=0,e[12]=-(a*m+o*p+s*y),e[13]=-(u*m+l*p+c*y),e[14]=-(h*m+d*p+v*y),e[15]=1,e)},g.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},g.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},void 0!==n&&(n.mat4=g),(m={}).create=function(){var e=new a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},m.rotationTo=function(){var e=c.create(),t=c.fromValues(1,0,0),i=c.fromValues(0,1,0);return function(n,r,a){var o=c.dot(r,a);return-.999999>o?(c.cross(e,t,r),c.length(e)<1e-6&&c.cross(e,i,r),c.normalize(e,e),m.setAxisAngle(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(c.cross(e,r,a),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,m.normalize(n,n))}}(),m.setAxes=function(){var e=f.create();return function(t,i,n,r){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],m.normalize(t,m.fromMat3(t,e))}}(),m.clone=h.clone,m.fromValues=h.fromValues,m.copy=h.copy,m.set=h.set,m.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},m.setAxisAngle=function(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e},m.add=h.add,m.multiply=function(e,t,i){var n=t[0],r=t[1],a=t[2],o=t[3],s=i[0],u=i[1],l=i[2],c=i[3];return e[0]=n*c+o*s+r*l-a*u,e[1]=r*c+o*u+a*s-n*l,e[2]=a*c+o*l+n*u-r*s,e[3]=o*c-n*s-r*u-a*l,e},m.mul=m.multiply,m.scale=h.scale,m.rotateX=function(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=n*u+o*s,e[1]=r*u+a*s,e[2]=a*u-r*s,e[3]=o*u-n*s,e},m.rotateY=function(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=n*u-a*s,e[1]=r*u+o*s,e[2]=a*u+n*s,e[3]=o*u-r*s,e},m.rotateZ=function(e,t,i){i*=.5;var n=t[0],r=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=n*u+r*s,e[1]=r*u-n*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e},m.calculateW=function(e,t){var i=t[0],n=t[1],r=t[2];return e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e},m.dot=h.dot,m.lerp=h.lerp,m.slerp=function(e,t,i,n){var r,a,o,s,u=t[0],l=t[1],c=t[2],h=t[3],d=i[0],v=i[1],f=i[2],g=i[3],m=u*d+l*v+c*f+h*g;return 0>m&&(m=-m,d=-d,v=-v,f=-f,g=-g),1-m>1e-6?(r=Math.acos(m),a=Math.sin(r),o=Math.sin((1-n)*r)/a,s=Math.sin(n*r)/a):(o=1-n,s=n),e[0]=o*u+s*d,e[1]=o*l+s*v,e[2]=o*c+s*f,e[3]=o*h+s*g,e},m.invert=function(e,t){var i=t[0],n=t[1],r=t[2],a=t[3],o=i*i+n*n+r*r+a*a,s=o?1/o:0;return e[0]=-i*s,e[1]=-n*s,e[2]=-r*s,e[3]=a*s,e},m.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},m.length=h.length,m.len=m.length,m.squaredLength=h.squaredLength,m.sqrLen=m.squaredLength,m.normalize=h.normalize,m.fromMat3=function(e,t){var i,n,r,a,o=t[0]+t[4]+t[8];return o>0?(i=Math.sqrt(o+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i):(n=0,t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2),r=(n+1)%3,a=(n+2)%3,i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*a+a]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+a]-t[3*a+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[a]=(t[3*a+n]+t[3*n+a])*i),e},m.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},void 0!==n&&(n.quat=m),t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={alpha:0,beta:0,gamma:0},r=void 0,a=void 0,o=!1,s=void 0,u=!1,l=void 0,c=16,h=window.location.search.indexOf("gyroDebug=true")>=0,d=Math.PI/180;function v(e){var t=e.alpha,i=e.beta,u=e.gamma;if(t=+t.toFixed(2),i=+i.toFixed(2),u=+u.toFixed(2),r)return a.push({alpha:t,beta:i,gamma:u}),void(a.length>=10&&(r=!1,(n=function(){console.debug("calcBase(): "+a.length);var e=a[a.length-1];if(a.length>20)return e;for(var t=void 0,i=0,n=0,r=0,o=a.length-2;o>=0;o--)if(t=a.length-o-1,i+=a[o].alpha-e.alpha,n+=a[o].beta-e.beta,r+=a[o].gamma-e.gamma,a.length-o>=4&&i<=t&&n<=t&&r<=t)return e;return}())?console.debug(n.alpha+", "+n.beta+", "+n.gamma):r=!0));if(c>0){if(o)return;o=!0,setTimeout((function(){o=!1}),c)}var h=function(e,t,i){var n=function(e,t,i){var n=t?t*d:0,r=i?i*d:0,a=e?e*d:0,o=Math.cos(n),s=Math.cos(r),u=Math.cos(a),l=Math.sin(n),c=Math.sin(r),h=Math.sin(a);return[u*s-h*l*c,-o*h,s*h*l+u*c,s*h+u*l*c,u*o,h*c-u*s*l,-o*c,l,o*s]}(e,t,i),r=function(e){var t=e?e*d:0,i=Math.cos(t),n=Math.sin(t);return[i,n,0,-n,i,0,0,0,1]}(s);return a=n,o=r,u=[],u[0]=a[0]*o[0]+a[1]*o[3]+a[2]*o[6],u[1]=a[0]*o[1]+a[1]*o[4]+a[2]*o[7],u[2]=a[0]*o[2]+a[1]*o[5]+a[2]*o[8],u[3]=a[3]*o[0]+a[4]*o[3]+a[5]*o[6],u[4]=a[3]*o[1]+a[4]*o[4]+a[5]*o[7],u[5]=a[3]*o[2]+a[4]*o[5]+a[5]*o[8],u[6]=a[6]*o[0]+a[7]*o[3]+a[8]*o[6],u[7]=a[6]*o[1]+a[7]*o[4]+a[8]*o[7],u[8]=a[6]*o[2]+a[7]*o[5]+a[8]*o[8],u;var a,o,u}(t,i,u);l({base:n,offset:g(t,i,u),current:{alpha:t,beta:i,gamma:u},rotationMatrix:h})}function f(){s=+window.orientation}function g(e,t,i){var r={alpha:0,beta:0,gamma:0};return r.alpha=+(e-n.alpha).toFixed(2),r.beta=+(t-n.beta).toFixed(2),r.gamma=+(i-n.gamma).toFixed(2),r.alpha>180&&(r.alpha-=360),r}t.open=function(e,t){console.debug("gyro.open()"),n={alpha:0,beta:0,gamma:0},r=!0,a=[],l=e,t>=0&&(c=t),s=+window.orientation,window.addEventListener("deviceorientation",v,!1),window.addEventListener("orientationchange",f,!1)},t.close=function(){window.removeEventListener("deviceorientation",v),window.removeEventListener("orientationchange",f)},t.supports=function(){console.debug("gyro.supports()");var e="The browser does not enable deviceorientation.";return new Promise((function(t,i){if(h)t(!0);else if(window.DeviceOrientationEvent)if(window.DeviceOrientationEvent.requestPermission)window.DeviceOrientationEvent.requestPermission().then((function(n){"granted"===n?(u=!0,t(!0)):i({code:2,msg:e})})).catch((function(t){console.warn(t),i({code:2,msg:e})}));else{window.addEventListener("deviceorientation",(function n(r){window.removeEventListener("deviceorientation",n),r&&r.alpha>=0&&r.beta>=-180&&r.gamma>=-90?(u=!0,t(!0)):i({code:2,msg:e})}),!1)}else i({code:1,msg:"The browser does not support deviceorientation."})}))},t.isGranted=function(){return u}},function(e,t,i){"use strict";(function(e){var i,n,r,a,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window,a=function(){return i={},e.m=t=[function(e,t,i){t.__esModule=!0;var n="Uncaught TypeError: Failed to execute 'check' method: ";t.check=function(e,t,i,r,a){var s;if(!e||"object"!=(void 0===e?"undefined":o(e)))throw new Error(n+"The type of argument 'srcObj' is invalid.");if(void 0===t||t<=0)throw new Error(n+"The type of argument 'srcWidth' is invalid.");if(void 0===i||i<=0)throw new Error(n+"The type of argument 'srcHeight' is invalid.");r&&0<=r.r&&0<=r.g&&0<=r.b&&(s=r);var u=document.createElement("canvas"),l=u.getContext("2d");u.width=Math.ceil(.5*t),u.height=Math.ceil(.5*i),l.drawImage(e,0,0,u.width,u.height);for(var c=l.getImageData(0,0,u.width,u.height).data,h=0;h<c.length;h+=4){if(0===h&&void 0===r&&(s={r:c[0],g:c[1],b:c[2]}),c[h]!==s.r||c[h+1]!==s.g||c[h+2]!==s.b)return!1;if(void 0!==a&&0<=a&&c[h+3]!==a)return!1}return!0}}],e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==(void 0===t?"undefined":o(t))&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(n,r,function(e){return t[e]}.bind(null,r));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0);function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var t,i},"object"==o(t)&&"object"==o(e)?e.exports=a():(n=[],void 0===(r="function"==typeof(i=a)?i.apply(t,n):i)||(e.exports=r))}).call(this,i(9)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!window.requestAnimationFrame){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length;i++)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),r=window.setTimeout((function(){t(i+n)}),n);return e=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},r=void 0;t.bindThis=function(e){r=e},t.bindEvent=function(e,t){n[e]&&n[e]instanceof Array?n[e].push(t):n[e]=[t]},t.unbindEvent=function(e,t){if(n[e]&&n[e].length>0)for(var i=0;i<n[e].length;i++)n[e][i]===t&&n[e].splice(i,1)},t.triggerEvent=function(e,t,i){if(!t||t instanceof Array||(i=t,t=void 0),n[e]&&n[e].length>0){var a=!0,o=!1,s=void 0;try{for(var u,l=n[e][Symbol.iterator]();!(a=(u=l.next()).done);a=!0){u.value.call(i||r||this,t)}}catch(e){o=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(o)throw s}}return!0}return!1}},function(e,t,i){"use strict";i.r(t),t.default="attribute vec3 aVertex;\r\nattribute vec2 aTexture;\r\nattribute float aTextureScaleX;\r\nattribute float aTextureOffsetX;\r\nattribute float aTextureScaleY;\r\nattribute float aTextureOffsetY;\r\nuniform mat4 uMMatrix;\r\nuniform mat4 uPMatrix;\r\nvarying vec2 vTexture;\r\nvoid main(){\r\n   gl_Position = uPMatrix * uMMatrix * vec4(aVertex,1.0);\r\n   vec2 tScale = vec2(aTextureScaleX,aTextureScaleY);\r\n   vec2 tOffset = vec2(aTextureOffsetX,aTextureOffsetY);\r\n   vTexture = aTexture * tScale + tOffset;\r\n}"},function(e,t,i){"use strict";i.r(t),t.default="#ifdef GL_ES\r\n#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\n#else\r\nprecision mediump float;\r\n#endif\r\n#endif\r\nuniform float fAlpha;\r\nuniform sampler2D uSampler;\r\nvarying vec2 vTexture;\r\nvoid main(){\r\n   vec4 c = texture2D(uSampler,vec2(vTexture.s,vTexture.t),-1.0);\r\n   gl_FragColor = vec4(c.rgb,c.a*fAlpha);\r\n}"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkBrowser=function(e){var t=e.platform,i=e.ua,n=!1,r=void 0,a=void 0,o=void 0,s=void 0,u=void 0;return"android"===t&&(r=/chrome\//i.test(i),/MiuiBrowser\//i.test(i),a=/chrome\/(\d+\.\d)/i.test(i)?+RegExp.$1:null,o=/AppleWebKit\/(\d+\.\d)/i.test(i)?+RegExp.$1:null,s=/MQQBrowser\/(\d+\.\d)/i.test(i)?+RegExp.$1:null,u=/TBS\/(\d+)/i.test(i)?+RegExp.$1:null,r&&a<47&&(n=!0),o&&o<537&&(n=!0),/chrome\/45.0.2454.94/i.test(i)&&(n=!1),/chrome\/44.0.2403.133/i.test(i)&&(n=!1),s&&s>=7&&(n=!1),u&&u>=36824&&(n=!1),"Huawei"===e.brand&&+e.aOSVer.split(".")[0]<=8&&(n=!0)),"iphone"!==t&&"ipod"!==t&&"ipad"!==t||!/UCBrowser\//i.test(i)||(n=!0),n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={aVertex:void 0,aTexture:void 0,aTextureScaleX:void 0,aTextureScaleY:void 0,aTextureOffsetX:void 0,aTextureOffsetY:void 0,uMMatrix:void 0,uPMatrix:void 0,fAlpha:void 0};function r(e,t,i,r,a){e.vertexAttrib1f(n.aTextureScaleX,t),e.vertexAttrib1f(n.aTextureOffsetX,i),e.vertexAttrib1f(n.aTextureScaleY,r),e.vertexAttrib1f(n.aTextureOffsetY,a)}t.runProgram=function(e,t){e.useProgram(t),function(e,t){n.aVertex=e.getAttribLocation(t,"aVertex"),n.aTexture=e.getAttribLocation(t,"aTexture"),n.aTextureScaleX=e.getAttribLocation(t,"aTextureScaleX"),n.aTextureScaleY=e.getAttribLocation(t,"aTextureScaleY"),n.aTextureOffsetX=e.getAttribLocation(t,"aTextureOffsetX"),n.aTextureOffsetY=e.getAttribLocation(t,"aTextureOffsetY"),n.uMMatrix=e.getUniformLocation(t,"uMMatrix"),n.uPMatrix=e.getUniformLocation(t,"uPMatrix"),n.fAlpha=e.getUniformLocation(t,"fAlpha"),e.enableVertexAttribArray(n.aVertex),e.enableVertexAttribArray(n.aTexture),r(e,1,0,1,0)}(e,t)},t.glBindTexture=function(e,t,i){e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.bindTexture(e.TEXTURE_2D,null)},t.bindGLBuffer=function(e,t){e.bindBuffer(e.ARRAY_BUFFER,t.vertexMatrixBuffer),e.vertexAttribPointer(n.aVertex,t.vertexMatrixBuffer.vertexSize,e.FLOAT,!0,0,0),e.bindBuffer(e.ARRAY_BUFFER,t.ratioListBuffer),e.vertexAttribPointer(n.aTexture,t.ratioListBuffer.vertexSize,e.FLOAT,!0,0,0),e.bindTexture(e.TEXTURE_2D,t.aTexture),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.vertexIndexListBuffer)},t.clearGLBuffer=function(e,t){t&&t.vertexMatrixBuffer&&(e.deleteBuffer(t.vertexMatrixBuffer),e.deleteBuffer(t.ratioListBuffer),e.deleteBuffer(t.vertexIndexListBuffer),e.deleteTexture(t.aTexture))},t.drawGraphics=function(e,t,i,a,o){var s=t.vertexIndexListBuffer.sum;!function(e,t,i){e.uniformMatrix4fv(n.uMMatrix,!1,t),e.uniformMatrix4fv(n.uPMatrix,!1,i),e.uniform1fv(n.fAlpha,new Float32Array([1]))}(e,a,o),r(e,1,0,1,0),e.viewport(0,0,i.viewWidth,i.viewHeight),e.drawElements(e.TRIANGLES,s,e.UNSIGNED_SHORT,0)}}])}));